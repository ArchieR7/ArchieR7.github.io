<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Xcode Cloud ä¸€èˆ¬æˆ‘å€‘çš„ç™¼ä½ˆæµç¨‹ç‚ºï¼Œå¾å¯«ç¨‹å¼åˆ°æ¸¬è©¦ï¼Œæ¥è‘—æ•´åˆå¾Œç™¼ä½ˆï¼Œå†ä¾†æ¥è‘—æ”¶é›†è³‡è¨Šå¾Œå†é€²è¡Œä¸‹ä¸€è¼ªé–‹ç™¼ã€‚ Xcode Cloud å°‡é€™ä¸€åˆ‡æ•´åˆåœ¨åŒä¸€å€‹æœå‹™ä¹‹ä¸­ï¼Œè®“æˆ‘å€‘å¯ä»¥ç›´æ¥å¯«å®Œç¨‹å¼ä¹‹å¾Œï¼Œå»ºç«‹ workflow ä¸¦æ•´åˆ Git æœå‹™ï¼ˆGitHub, GitLab ç­‰ï¼‰ï¼Œæ¥è‘—ä¸²æ¥ App Store Connect é€²è¡Œ TestFlight å’Œç™¼ä½ˆã€‚ æˆ‘å€‘ä¹‹å¾Œå°±å¯ä»¥å¾å–®ä¸€çš„ Xcode Cloud ä»‹é¢è™•ç†å®Œä¸Šè¿°çš„æ‰€æœ‰äº‹æƒ…ï¼Œè€Œå»ºç«‹é€™äº› CI/CD åªéœ€è¦ä¸€åˆ†é˜çš„æ™‚é–“ã€‚
ç›¸æ¯”ä¹‹å‰å¼„ GitHub actionï¼Œæ‡‰è©²å¯ä»¥ç®—æ˜¯æ›´åŠ å®¹æ˜“è¨±å¤šï¼ˆï¼Ÿ
å»ºæ§‹å››æ­¥é©Ÿ é¸æ“‡ product ç¢ºèª workflow æˆæ¬Šç›¸å°æ‡‰çš„ source code é€£æ¥ App Store Connect åœ¨ CI/CD çš„æ¸¬è©¦ä»¥åŠ Code Review ä¸Šçš„é«”é©—éƒ½æœƒæ¯”åŸå…ˆä½¿ç”¨å…¶ä»–æœå‹™ä¸Šå¥½å¾ˆå¤šï¼Œç•¢ç«Ÿæ˜¯åŸç”Ÿçš„é«”é©—ï¼Œåœ¨ DEMO å½±ç‰‡ä¸Šçœ‹èµ·ä¾†éƒ½è »æœ‰è¶£çš„ã€‚
ç›®å‰å¯ä»¥é€éé€™å€‹é€£çµä¾†è¨»å†Š Beta ä½¿ç”¨ï¼Œè‹¥æœ‰æ©Ÿæœƒçš„è©±å†ä¾†è©³ç´°å¯«ä¸€ç¯‡é€™éƒ¨åˆ†çš„é«”é©—ã€‚
Swift concurrency async å’Œ await çš„ä¾†è‡¨è®“æˆ‘å€‘èƒ½å¤ å–ä»£åŸå…ˆçš„ completion handler
Completion handler
func prepareForShow(completion: @escaping (Result&amp;lt;Scene, Error&amp;gt;) -&amp;gt; Void) { danceCompany.warmUp(duration: .minutes (45)) { result in switch result { case ."><title>WWDC21 - Platforms State of the Union</title><link rel=canonical href=https://www.archie.tw/p/wwdc21-platforms-state-of-the-union/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="WWDC21 - Platforms State of the Union"><meta property="og:description" content="Xcode Cloud ä¸€èˆ¬æˆ‘å€‘çš„ç™¼ä½ˆæµç¨‹ç‚ºï¼Œå¾å¯«ç¨‹å¼åˆ°æ¸¬è©¦ï¼Œæ¥è‘—æ•´åˆå¾Œç™¼ä½ˆï¼Œå†ä¾†æ¥è‘—æ”¶é›†è³‡è¨Šå¾Œå†é€²è¡Œä¸‹ä¸€è¼ªé–‹ç™¼ã€‚ Xcode Cloud å°‡é€™ä¸€åˆ‡æ•´åˆåœ¨åŒä¸€å€‹æœå‹™ä¹‹ä¸­ï¼Œè®“æˆ‘å€‘å¯ä»¥ç›´æ¥å¯«å®Œç¨‹å¼ä¹‹å¾Œï¼Œå»ºç«‹ workflow ä¸¦æ•´åˆ Git æœå‹™ï¼ˆGitHub, GitLab ç­‰ï¼‰ï¼Œæ¥è‘—ä¸²æ¥ App Store Connect é€²è¡Œ TestFlight å’Œç™¼ä½ˆã€‚ æˆ‘å€‘ä¹‹å¾Œå°±å¯ä»¥å¾å–®ä¸€çš„ Xcode Cloud ä»‹é¢è™•ç†å®Œä¸Šè¿°çš„æ‰€æœ‰äº‹æƒ…ï¼Œè€Œå»ºç«‹é€™äº› CI/CD åªéœ€è¦ä¸€åˆ†é˜çš„æ™‚é–“ã€‚
ç›¸æ¯”ä¹‹å‰å¼„ GitHub actionï¼Œæ‡‰è©²å¯ä»¥ç®—æ˜¯æ›´åŠ å®¹æ˜“è¨±å¤šï¼ˆï¼Ÿ
å»ºæ§‹å››æ­¥é©Ÿ é¸æ“‡ product ç¢ºèª workflow æˆæ¬Šç›¸å°æ‡‰çš„ source code é€£æ¥ App Store Connect åœ¨ CI/CD çš„æ¸¬è©¦ä»¥åŠ Code Review ä¸Šçš„é«”é©—éƒ½æœƒæ¯”åŸå…ˆä½¿ç”¨å…¶ä»–æœå‹™ä¸Šå¥½å¾ˆå¤šï¼Œç•¢ç«Ÿæ˜¯åŸç”Ÿçš„é«”é©—ï¼Œåœ¨ DEMO å½±ç‰‡ä¸Šçœ‹èµ·ä¾†éƒ½è »æœ‰è¶£çš„ã€‚
ç›®å‰å¯ä»¥é€éé€™å€‹é€£çµä¾†è¨»å†Š Beta ä½¿ç”¨ï¼Œè‹¥æœ‰æ©Ÿæœƒçš„è©±å†ä¾†è©³ç´°å¯«ä¸€ç¯‡é€™éƒ¨åˆ†çš„é«”é©—ã€‚
Swift concurrency async å’Œ await çš„ä¾†è‡¨è®“æˆ‘å€‘èƒ½å¤ å–ä»£åŸå…ˆçš„ completion handler
Completion handler
func prepareForShow(completion: @escaping (Result&amp;lt;Scene, Error&amp;gt;) -&amp;gt; Void) { danceCompany.warmUp(duration: .minutes (45)) { result in switch result { case ."><meta property="og:url" content="https://www.archie.tw/p/wwdc21-platforms-state-of-the-union/"><meta property="og:site_name" content="Archie"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="iOS"><meta property="article:published_time" content="2021-06-12T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-12T00:00:00+00:00"><meta name=twitter:site content="@ChangArchie"><meta name=twitter:creator content="@ChangArchie"><meta name=twitter:title content="WWDC21 - Platforms State of the Union"><meta name=twitter:description content="Xcode Cloud ä¸€èˆ¬æˆ‘å€‘çš„ç™¼ä½ˆæµç¨‹ç‚ºï¼Œå¾å¯«ç¨‹å¼åˆ°æ¸¬è©¦ï¼Œæ¥è‘—æ•´åˆå¾Œç™¼ä½ˆï¼Œå†ä¾†æ¥è‘—æ”¶é›†è³‡è¨Šå¾Œå†é€²è¡Œä¸‹ä¸€è¼ªé–‹ç™¼ã€‚ Xcode Cloud å°‡é€™ä¸€åˆ‡æ•´åˆåœ¨åŒä¸€å€‹æœå‹™ä¹‹ä¸­ï¼Œè®“æˆ‘å€‘å¯ä»¥ç›´æ¥å¯«å®Œç¨‹å¼ä¹‹å¾Œï¼Œå»ºç«‹ workflow ä¸¦æ•´åˆ Git æœå‹™ï¼ˆGitHub, GitLab ç­‰ï¼‰ï¼Œæ¥è‘—ä¸²æ¥ App Store Connect é€²è¡Œ TestFlight å’Œç™¼ä½ˆã€‚ æˆ‘å€‘ä¹‹å¾Œå°±å¯ä»¥å¾å–®ä¸€çš„ Xcode Cloud ä»‹é¢è™•ç†å®Œä¸Šè¿°çš„æ‰€æœ‰äº‹æƒ…ï¼Œè€Œå»ºç«‹é€™äº› CI/CD åªéœ€è¦ä¸€åˆ†é˜çš„æ™‚é–“ã€‚
ç›¸æ¯”ä¹‹å‰å¼„ GitHub actionï¼Œæ‡‰è©²å¯ä»¥ç®—æ˜¯æ›´åŠ å®¹æ˜“è¨±å¤šï¼ˆï¼Ÿ
å»ºæ§‹å››æ­¥é©Ÿ é¸æ“‡ product ç¢ºèª workflow æˆæ¬Šç›¸å°æ‡‰çš„ source code é€£æ¥ App Store Connect åœ¨ CI/CD çš„æ¸¬è©¦ä»¥åŠ Code Review ä¸Šçš„é«”é©—éƒ½æœƒæ¯”åŸå…ˆä½¿ç”¨å…¶ä»–æœå‹™ä¸Šå¥½å¾ˆå¤šï¼Œç•¢ç«Ÿæ˜¯åŸç”Ÿçš„é«”é©—ï¼Œåœ¨ DEMO å½±ç‰‡ä¸Šçœ‹èµ·ä¾†éƒ½è »æœ‰è¶£çš„ã€‚
ç›®å‰å¯ä»¥é€éé€™å€‹é€£çµä¾†è¨»å†Š Beta ä½¿ç”¨ï¼Œè‹¥æœ‰æ©Ÿæœƒçš„è©±å†ä¾†è©³ç´°å¯«ä¸€ç¯‡é€™éƒ¨åˆ†çš„é«”é©—ã€‚
Swift concurrency async å’Œ await çš„ä¾†è‡¨è®“æˆ‘å€‘èƒ½å¤ å–ä»£åŸå…ˆçš„ completion handler
Completion handler
func prepareForShow(completion: @escaping (Result&amp;lt;Scene, Error&amp;gt;) -&amp;gt; Void) { danceCompany.warmUp(duration: .minutes (45)) { result in switch result { case ."><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-149460095-2","auto"),ga("send","pageview"))</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4467778867013569" crossorigin=anonymous></script></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://www.archie.tw class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span></span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E9%96%8B%E7%99%BC%E5%BF%83%E5%BE%97/>ğŸ é–‹ç™¼å¿ƒå¾—</a></header><h2 class=article-title><a href=/p/wwdc21-platforms-state-of-the-union/>WWDC21 - Platforms State of the Union</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jun 12, 2021</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading></time></div></footer></div></header><section class=article-content><h3 id=xcode-cloud>Xcode Cloud</h3><p>ä¸€èˆ¬æˆ‘å€‘çš„ç™¼ä½ˆæµç¨‹ç‚ºï¼Œå¾å¯«ç¨‹å¼åˆ°æ¸¬è©¦ï¼Œæ¥è‘—æ•´åˆå¾Œç™¼ä½ˆï¼Œå†ä¾†æ¥è‘—æ”¶é›†è³‡è¨Šå¾Œå†é€²è¡Œä¸‹ä¸€è¼ªé–‹ç™¼ã€‚<figure><a href=/../img/image-1623429314442.png><img src=/../img/image-1623429314442.png loading=lazy></a></figure></p><p>Xcode Cloud å°‡é€™ä¸€åˆ‡æ•´åˆåœ¨åŒä¸€å€‹æœå‹™ä¹‹ä¸­ï¼Œè®“æˆ‘å€‘å¯ä»¥ç›´æ¥å¯«å®Œç¨‹å¼ä¹‹å¾Œï¼Œå»ºç«‹ workflow ä¸¦æ•´åˆ Git æœå‹™ï¼ˆGitHub, GitLab ç­‰ï¼‰ï¼Œæ¥è‘—ä¸²æ¥ App Store Connect é€²è¡Œ TestFlight å’Œç™¼ä½ˆã€‚<figure><a href=/../img/image-1623429354737.png><img src=/../img/image-1623429354737.png loading=lazy></a></figure></p><p>æˆ‘å€‘ä¹‹å¾Œå°±å¯ä»¥å¾å–®ä¸€çš„ Xcode Cloud ä»‹é¢è™•ç†å®Œä¸Šè¿°çš„æ‰€æœ‰äº‹æƒ…ï¼Œè€Œå»ºç«‹é€™äº› CI/CD åªéœ€è¦ä¸€åˆ†é˜çš„æ™‚é–“ã€‚</p><p>ç›¸æ¯”ä¹‹å‰å¼„ GitHub actionï¼Œæ‡‰è©²å¯ä»¥ç®—æ˜¯æ›´åŠ å®¹æ˜“è¨±å¤šï¼ˆï¼Ÿ</p><h4 id=å»ºæ§‹å››æ­¥é©Ÿ>å»ºæ§‹å››æ­¥é©Ÿ</h4><ol><li>é¸æ“‡ product</li><li>ç¢ºèª workflow</li><li>æˆæ¬Šç›¸å°æ‡‰çš„ source code</li><li>é€£æ¥ App Store Connect</li></ol><p>åœ¨ CI/CD çš„æ¸¬è©¦ä»¥åŠ Code Review ä¸Šçš„é«”é©—éƒ½æœƒæ¯”åŸå…ˆä½¿ç”¨å…¶ä»–æœå‹™ä¸Šå¥½å¾ˆå¤šï¼Œç•¢ç«Ÿæ˜¯åŸç”Ÿçš„é«”é©—ï¼Œåœ¨ DEMO å½±ç‰‡ä¸Šçœ‹èµ·ä¾†éƒ½è »æœ‰è¶£çš„ã€‚</p><p>ç›®å‰å¯ä»¥é€é<a class=link href=https://developer.apple.com/xcode-cloud/beta/request/#!/agree target=_blank rel=noopener>é€™å€‹é€£çµä¾†è¨»å†Š Beta ä½¿ç”¨</a>ï¼Œè‹¥æœ‰æ©Ÿæœƒçš„è©±å†ä¾†è©³ç´°å¯«ä¸€ç¯‡é€™éƒ¨åˆ†çš„é«”é©—ã€‚</p><p><figure><a href=/../img/image-1623431306073.png><img src=/../img/image-1623431306073.png loading=lazy></a></figure></p><h3 id=swift-concurrency>Swift concurrency</h3><p><code>async</code> å’Œ <code>await</code> çš„ä¾†è‡¨è®“æˆ‘å€‘èƒ½å¤ å–ä»£åŸå…ˆçš„ completion handler</p><p>Completion handler</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>prepareForShow</span><span class=p>(</span><span class=n>completion</span><span class=p>:</span> <span class=p>@</span><span class=n>escaping</span> <span class=p>(</span><span class=n>Result</span><span class=p>&lt;</span><span class=n>Scene</span><span class=p>,</span> <span class=n>Error</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=nb>Void</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>	<span class=n>danceCompany</span><span class=p>.</span><span class=n>warmUp</span><span class=p>(</span><span class=n>duration</span><span class=p>:</span> <span class=p>.</span><span class=n>minutes</span> <span class=p>(</span><span class=mi>45</span><span class=p>))</span> <span class=p>{</span> <span class=n>result</span> <span class=k>in</span> 
</span></span><span class=line><span class=cl>		<span class=k>switch</span> <span class=n>result</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=p>.</span><span class=n>success</span> <span class=p>(</span><span class=kd>let</span> <span class=nv>dancers</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>				<span class=kc>self</span><span class=p>.</span><span class=n>crew</span><span class=p>.</span><span class=n>fetchStageScenery</span> <span class=p>{</span> <span class=n>scenery</span> <span class=k>in</span> 
</span></span><span class=line><span class=cl>					<span class=kc>self</span><span class=p>.</span><span class=n>setStage</span><span class=p>(</span><span class=n>with</span><span class=p>:</span> <span class=n>scenery</span><span class=p>)</span> <span class=p>{</span> <span class=n>openingScene</span> <span class=k>in</span> 
</span></span><span class=line><span class=cl>						<span class=n>dancers</span><span class=p>.</span><span class=n>moveToPosition</span><span class=p>(</span><span class=k>in</span><span class=p>:</span> <span class=n>openingScene</span><span class=p>)</span> <span class=p>{</span> <span class=n>result</span> <span class=k>in</span> 
</span></span><span class=line><span class=cl>							<span class=n>completion</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>						<span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span> 
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=p>.</span><span class=n>failure</span><span class=p>(</span><span class=kd>let</span> <span class=nv>error</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>			  <span class=n>completion</span><span class=p>(.</span><span class=n>failure</span> <span class=p>(</span><span class=n>error</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>await</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>prepareForShow</span><span class=p>()</span> <span class=n>async</span> <span class=kr>throws</span> <span class=p>-&gt;</span> <span class=n>Scene</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nv>dancers</span> <span class=p>=</span> <span class=k>try</span> <span class=n>await</span> <span class=n>danceCompany</span><span class=p>.</span><span class=n>warmUp</span> <span class=p>(</span><span class=n>duration</span><span class=p>:</span> <span class=p>.</span><span class=n>minutes</span> <span class=p>(</span><span class=mi>45</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nv>scenery</span> <span class=p>=</span> <span class=n>await</span> <span class=n>crew</span><span class=p>.</span><span class=n>fetchStageScenery</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nv>openingScene</span> <span class=p>=</span> <span class=n>setStage</span><span class=p>(</span><span class=n>with</span><span class=p>:</span> <span class=n>scenery</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=k>try</span> <span class=n>await</span> <span class=n>dancers</span><span class=p>.</span><span class=n>moveToPosition</span> <span class=p>(</span><span class=k>in</span><span class=p>:</span> <span class=n>openingScene</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ä¸éé€™é‚Šå¦ä¸€å€‹å•é¡Œæ˜¯ï¼ŒSwift Concurrency åªæœ‰æ”¯æ´ iOS 15 / macOS 12 ä»¥å¾Œçš„ç‰ˆæœ¬â‹¯
ç›¸é—œçš„è¨è«–ä¸²å¯ä»¥çœ‹
<a class=link href=https://forums.swift.org/t/will-swift-concurrency-deploy-back-to-older-oss/49370 target=_blank rel=noopener>Will Swift Concurrency deploy back to older OSs?</a></p><h3 id=structured-concurrency>Structured Concurrency</h3><p>å¦‚æœæˆ‘å€‘æƒ³è®“ dances å’Œ scenery åŒæ™‚é€²è¡Œï¼Œä¾¿å¯ä»¥æ”¹æˆ <code>async</code> çš„æ–¹å¼</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>prepareForShow</span><span class=p>()</span> <span class=n>async</span> <span class=kr>throws</span> <span class=p>-&gt;</span> <span class=n>Scene</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>	<span class=n>async</span> <span class=kd>let</span> <span class=nv>dancers</span> <span class=p>=</span> <span class=n>danceCompany</span><span class=p>.</span><span class=n>warmUp</span><span class=p>(</span><span class=n>duration</span><span class=p>:</span> <span class=p>.</span><span class=n>minutes</span> <span class=p>(</span><span class=mi>45</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>	<span class=n>async</span> <span class=kd>let</span> <span class=nv>scenery</span> <span class=p>=</span> <span class=n>crew</span><span class=p>.</span><span class=n>fetchStageScenery</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nv>openingScene</span> <span class=p>=</span> <span class=n>setStage</span><span class=p>(</span><span class=n>with</span><span class=p>:</span> <span class=n>await</span> <span class=n>scenery</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=k>try</span> <span class=n>await</span> <span class=n>dancers</span><span class=p>.</span> <span class=n>moveToPosition</span><span class=p>(</span><span class=k>in</span><span class=p>:</span> <span class=n>openingScene</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=actors>Actors</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>class</span> <span class=nc>StageManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nv>stage</span><span class=p>:</span> <span class=n>Stage</span> 
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nv>queue</span> <span class=p>=</span> <span class=n>DispatchQueue</span><span class=p>(</span><span class=n>label</span><span class=p>:</span> <span class=s>&#34;stage&#34;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>func</span> <span class=nf>setStage</span><span class=p>(</span><span class=n>with</span> <span class=n>scenery</span><span class=p>:</span> <span class=n>Scenery</span><span class=p>,</span> <span class=n>completion</span><span class=p>:</span> <span class=p>@</span><span class=n>escaping</span> <span class=p>(</span><span class=n>Scene</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=nb>Void</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>  	<span class=n>queue</span><span class=p>.</span><span class=n>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kc>self</span><span class=p>.</span><span class=n>stage</span><span class=p>.</span><span class=n>backdrop</span> <span class=p>=</span> <span class=n>scenery</span><span class=p>.</span><span class=n>backdrop</span> 
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=n>prop</span> <span class=k>in</span> <span class=n>scenery</span><span class=p>.</span><span class=n>props</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      	<span class=kc>self</span><span class=p>.</span><span class=n>stage</span><span class=p>.</span><span class=n>addProp</span><span class=p>(</span><span class=n>prop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    	<span class=p>}</span>
</span></span><span class=line><span class=cl>    	<span class=n>completion</span><span class=p>(</span><span class=kc>self</span><span class=p>.</span><span class=n>stage</span><span class=p>.</span> <span class=n>currentScene</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>éå»æˆ‘å€‘åˆ©ç”¨ <code>DispatchQueue</code> çš„ <code>async</code> æ–¹å¼ä¾†ç¢ºä¿ç‰©ä»¶ä¸æœƒè¢«åŒæ™‚å¯«å…¥çš„å•é¡Œã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=n>actor</span> <span class=n>StageManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nv>stage</span><span class=p>:</span> <span class=n>Stage</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>func</span> <span class=nf>setStage</span><span class=p>(</span><span class=n>with</span> <span class=n>scenery</span><span class=p>:</span> <span class=n>Scenery</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=n>Scene</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=n>stage</span><span class=p>.</span><span class=n>backdrop</span> <span class=p>=</span> <span class=n>scenery</span><span class=p>.</span><span class=n>backdrop</span> 
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=n>prop</span> <span class=k>in</span> <span class=n>scenery</span><span class=p>.</span><span class=n>props</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>  		<span class=n>stage</span><span class=p>.</span><span class=n>addProp</span><span class=p>(</span><span class=n>prop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> 
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>stage</span><span class=p>.</span><span class=n>currentScene</span> 
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ç¾åœ¨å¯ä»¥é€éæ”¹ä»¥ Actor çš„æ–¹å¼ï¼Œå®ƒèƒ½å¤ é”åˆ°ä¸Šè¿°çš„æ•ˆæœä¸¦ä¸”è‡ªå‹•é¿å… race conditionsï¼›æ–¼æ˜¯æˆ‘å€‘ä¾¿ä¸ç”¨æ‰‹å‹•åœ°å»åŸ·è¡Œ sync çš„å‹•ä½œã€‚</p><p>è€Œå¦‚æœæœ‰ç‰¹å®šçš„ function å¿…é ˆåœ¨ main thread ä¸ŠåŸ·è¡Œçš„è©±ï¼Œå‰‡å¯ä»¥ä½¿ç”¨ <code>@MainActor</code> çš„æ–¹å¼</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=p>@</span><span class=n>MainActor</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>display</span><span class=p>(</span><span class=n>scene</span><span class=p>:</span> <span class=n>Scene</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=swiftui>SwiftUI</h3><p>ç¾åœ¨å·²ç¶“æœ‰ä¸å°‘åŸç”Ÿçš„ apps æ˜¯ä½¿ç”¨ SwiftUI å¯«å‡ºä¾†çš„ï¼ˆåƒæ˜¯å¤©æ°£.appï¼‰ï¼Œè€Œä¹Ÿæœ‰è¶Šä¾†è¶Šå¤šç³»çµ±çš„å…ƒä»¶ä¹Ÿæ˜¯ä½¿ç”¨ SwiftUIï¼ˆå¦‚ Apple pay sheetï¼‰ã€‚</p><p>è€Œé€™ä¸€æ¬¡ä¹Ÿæ›´æ–°äº†è¨±å¤šæ–°çš„ features å’Œ apiï¼Œä¸¦æ”¯æ´äº† #if else ä¾†ä¾ç…§ä¸åŒçš„ statement ä¹Ÿå¯ä»¥åœ¨ SwiftUI ä¸Šå¯¦ä½œã€‚</p><p>è©³ç´°çš„å…§å®¹ç­‰å…¶ä»–ç¯‡å†ä¾†ä¸€åŒæ•´ç†ã€‚</p><h3 id=swift-playground-4>Swift Playground 4</h3><p>Swift Playground 4 å°‡ä»Šå¹´ä¸Šç·šï¼Œä½¿ç”¨è€…å¯ä»¥ç›´æ¥åœ¨ä¸Šé ­ build app ä¸¦ä¸Šå‚³åˆ° App Store å»ï¼Œæ„å‘³è‘—åªä½¿ç”¨ iPad ä½œç‚ºé–‹ç™¼è€…è£ç½®çš„å¯è¡Œæ€§å‡ºç¾äº†ã€‚</p><p><figure><a href=/../img/image-1623467033840.png><img src=/../img/image-1623467033840.png loading=lazy></a></figure></p><p><figure><a href=/../img/image-1623467129289.png><img src=/../img/image-1623467129289.png loading=lazy></a></figure></p><h3 id=arkit>ARKit</h3><p>éå¾€å»ºç«‹ä¸€å€‹æ¨¡å‹éœ€è¦èŠ±è²»ä¸Šå°æ™‚çš„æ™‚é–“ï¼Œè€Œ Object Capture å¯ä»¥åˆ©ç”¨ iPhone æˆ–æ˜¯ iPad åœ¨å¹¾åˆ†é˜çš„æ™‚é–“å…§å»ºç«‹ä¸€å€‹ 3D æ¨¡å‹ã€‚</p><p>è¼¸å‡ºçš„æ ¼å¼æ”¯æ´ USDZï¼Œä¸”åˆ©ç”¨ Procedural Geometry API å¯ä»¥è£½ä½œå‡ºæ›´å¤šæ–°çš„æ•ˆæœï¼Œå¦‚é£Ÿç‰©ä¸Šçš„ç†±æ°£æˆ–æ˜¯ç«ç„°ã€‚</p><h3 id=focus>Focus</h3><p>ç®—æ˜¯å‹¿æ“¾æ¨¡å¼çš„ä¸€å€‹å»¶ä¼¸ï¼Œè®“ä½¿ç”¨è€…æœ‰æ›´å¤šå®¢è£½åŒ–çš„å‹¿æ“¾æ¨¡å¼è¨­å®šï¼Œè€Œé€™äº›è¨­å®šä¹Ÿæœƒè¢«å¥—ç”¨åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šã€‚</p><h3 id=notifications>Notifications</h3><p>Notifications åˆ†æˆæ–°çš„ä¸‰ç¨®ç­‰ç´š</p><ul><li>Passiveï¼šç•¶ä½¿ç”¨è€…æ­£åœ¨ä½¿ç”¨æ‰‹æ©Ÿçš„æ™‚å€™ï¼Œæ‰æœƒçœ‹åˆ°</li><li>Activeï¼šåŸæœ¬çš„é€šçŸ¥æ–¹å¼</li><li>Time sensitiveï¼šæœ‰æ™‚æ•ˆæ€§çš„é€šçŸ¥ï¼Œä¸¦ä¸” Siri æœƒé€é AirPods ä¾†å‘ŠçŸ¥ä½¿ç”¨è€…</li></ul><p>å¯ä»¥ç®¡ç†å€‹äººåŒ–çš„ summary of notificationsï¼Œè€Œåœ¨æ–°çš„ iMessage ä¸‹ï¼Œnotifications å°‡æœƒæŠŠåŸå…ˆçš„ app icon æ›æˆé‚£å€‹äººçš„é ­åƒã€‚</p><h3 id=widget>Widget</h3><p>Widgets æ”¯æ´æ“ºæ”¾åœ¨ iPad çš„ä¸»ç•«é¢ï¼Œå’Œ iOS ç›®å‰çš„æ•ˆæœä¸€æ¨£ï¼Œä¸¦ä¸”å¯ä»¥è¨­è¨ˆæ›´å¤§å°ºå¯¸çš„ widgetã€‚</p><h3 id=share-play-api>Share Play API</h3><p>é–‹æ”¾æ–°çš„ GroupActivities frameworkï¼Œè®“ä½¿ç”¨è€…åœ¨ Facetime é€šè©±ä¸­å¯ä»¥ share è‡ªå·±çš„æ’­æ”¾å…§å®¹æˆ–è€…ä¸€èµ·åšæŸäº›äº‹ï¼ˆso dome app activity togetherï¼‰ã€‚</p><h3 id=reference>Reference</h3><ul><li><a class=link href=https://wwdcnotes.com/notes/wwdc21/102/ target=_blank rel=noopener>WWDCNotes</a></li><li><a class=link href=https://developer.apple.com/videos/play/wwdc2021/102 target=_blank rel=noopener>Platforms State of the Union</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/ios/>iOS</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title></h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/p/%E7%99%BC%E7%A5%A8%E6%94%B6%E9%9B%86%E9%9B%9E-%E8%87%AA%E5%B7%B1%E7%9A%84%E7%99%BC%E7%A5%A8%E8%87%AA%E5%B7%B1%E6%94%B6/><div class=article-details><h2 class=article-title>ç™¼ç¥¨æ”¶é›†é› - è‡ªå·±çš„ç™¼ç¥¨è‡ªå·±æ”¶</h2></div></a></article><article><a href=/p/apple-watch-app-%E9%96%8B%E7%99%BC%E9%99%A4%E9%8C%AF%E5%BF%83%E5%BE%97/><div class=article-details><h2 class=article-title>Apple Watch App é–‹ç™¼é™¤éŒ¯å¿ƒå¾—</h2></div></a></article><article><a href=/p/rxswift-6-%E4%B8%8A%E7%B7%9A%E5%95%A6/><div class=article-details><h2 class=article-title>RxSwift 6 ä¸Šç·šå•¦ï¼</h2></div></a></article><article><a href=/p/xcode-11.4-archive-issue/><div class=article-details><h2 class=article-title>Xcode 11.4 archive issue</h2></div></a></article><article><a href=/p/ios-%E9%80%86%E5%90%91%E4%B8%8B%E8%BC%89-instagram-%E5%8B%95%E6%85%8B%E7%85%A7%E7%89%87/><div class=article-details><h2 class=article-title>ã€iOS é€†å‘ã€‘ä¸‹è¼‰ Instagram å‹•æ…‹ç…§ç‰‡</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//archie-1.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2022 Archie</section><section class=powerby><br></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title"></h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#xcode-cloud>Xcode Cloud</a><ol><li><a href=#å»ºæ§‹å››æ­¥é©Ÿ>å»ºæ§‹å››æ­¥é©Ÿ</a></li></ol></li><li><a href=#swift-concurrency>Swift concurrency</a></li><li><a href=#structured-concurrency>Structured Concurrency</a></li><li><a href=#actors>Actors</a></li><li><a href=#swiftui>SwiftUI</a></li><li><a href=#swift-playground-4>Swift Playground 4</a></li><li><a href=#arkit>ARKit</a></li><li><a href=#focus>Focus</a></li><li><a href=#notifications>Notifications</a></li><li><a href=#widget>Widget</a></li><li><a href=#share-play-api>Share Play API</a></li><li><a href=#reference>Reference</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>