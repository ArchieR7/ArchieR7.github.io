<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="é€™ç¯‡æ–‡ç« æœƒä»‹ç´¹æœ‰é—œæ–¼ Socket.IO åœ¨ server ç«¯ä»¥åŠ iOS ç«¯çš„ä¸€äº›å¯¦ä½œåˆ†äº«ã€‚
Server é¦–å…ˆæˆ‘å€‘å¯ä»¥å…ˆå¾ Socket.IO çš„ Get started é–‹å§‹ï¼Œå®ƒæ˜¯ä»¥ Node.JS æ‰€ç·¨å¯«çš„ï¼Œæ‰€ä»¥å…ˆåœ¨è³‡æ–™å¤¾ä½ç½®åŸ·è¡Œ
npm init é‚Šå¯ä»¥å–å¾—åŸºæœ¬çš„ä¸€äº›æª”æ¡ˆå’Œ package.jsonã€‚ æ¥è‘—å®‰è£ Socket.IO æ‰€éœ€è¦çš„ express
npm install --save express@4.15.2 ç„¶å¾Œæ–°å»ºä¸€å€‹ index.js çš„æª”æ¡ˆï¼Œè²¼ä¸Š
var app = require(&amp;#39;express&amp;#39;)(); var http = require(&amp;#39;http&amp;#39;).Server(app); app.get(&amp;#39;/&amp;#39;, function(req, res){ res.send(&amp;#39;&amp;lt;h1&amp;gt;Hello world&amp;lt;/h1&amp;gt;&amp;#39;); }); http.listen(3000, function(){ console.log(&amp;#39;listening on *:3000&amp;#39;); }); é€™æ¨£å¾…æœƒåŸ·è¡Œ node index.js çš„æ™‚å€™ä¾¿å¯ä»¥å¾ http://localhost:3000 ä¾†é€£ä¸Šé€™å€‹ serverã€‚
ç¢ºèª server ç›®å‰æ˜¯å¯ä»¥é€£ä¸Šå¾Œï¼Œä¾¿é–‹å§‹å®‰è£ Socket.IO åˆ°å…¶ä¸­
npm install --save socket.io ä¸¦åœ¨ index.js è£é ­åŠ ä¸Š Socket."><title>Socket.IO</title>
<link rel=canonical href=https://www.archie.tw/p/socket.io/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Socket.IO">
<meta property="og:description" content="é€™ç¯‡æ–‡ç« æœƒä»‹ç´¹æœ‰é—œæ–¼ Socket.IO åœ¨ server ç«¯ä»¥åŠ iOS ç«¯çš„ä¸€äº›å¯¦ä½œåˆ†äº«ã€‚
Server é¦–å…ˆæˆ‘å€‘å¯ä»¥å…ˆå¾ Socket.IO çš„ Get started é–‹å§‹ï¼Œå®ƒæ˜¯ä»¥ Node.JS æ‰€ç·¨å¯«çš„ï¼Œæ‰€ä»¥å…ˆåœ¨è³‡æ–™å¤¾ä½ç½®åŸ·è¡Œ
npm init é‚Šå¯ä»¥å–å¾—åŸºæœ¬çš„ä¸€äº›æª”æ¡ˆå’Œ package.jsonã€‚ æ¥è‘—å®‰è£ Socket.IO æ‰€éœ€è¦çš„ express
npm install --save express@4.15.2 ç„¶å¾Œæ–°å»ºä¸€å€‹ index.js çš„æª”æ¡ˆï¼Œè²¼ä¸Š
var app = require(&amp;#39;express&amp;#39;)(); var http = require(&amp;#39;http&amp;#39;).Server(app); app.get(&amp;#39;/&amp;#39;, function(req, res){ res.send(&amp;#39;&amp;lt;h1&amp;gt;Hello world&amp;lt;/h1&amp;gt;&amp;#39;); }); http.listen(3000, function(){ console.log(&amp;#39;listening on *:3000&amp;#39;); }); é€™æ¨£å¾…æœƒåŸ·è¡Œ node index.js çš„æ™‚å€™ä¾¿å¯ä»¥å¾ http://localhost:3000 ä¾†é€£ä¸Šé€™å€‹ serverã€‚
ç¢ºèª server ç›®å‰æ˜¯å¯ä»¥é€£ä¸Šå¾Œï¼Œä¾¿é–‹å§‹å®‰è£ Socket.IO åˆ°å…¶ä¸­
npm install --save socket.io ä¸¦åœ¨ index.js è£é ­åŠ ä¸Š Socket.">
<meta property="og:url" content="https://www.archie.tw/p/socket.io/">
<meta property="og:site_name" content="Archie">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2018-09-13T00:00:00+00:00"><meta property="article:modified_time" content="2018-09-13T00:00:00+00:00">
<meta name=twitter:site content="@ChangArchie">
<meta name=twitter:creator content="@ChangArchie"><meta name=twitter:title content="Socket.IO">
<meta name=twitter:description content="é€™ç¯‡æ–‡ç« æœƒä»‹ç´¹æœ‰é—œæ–¼ Socket.IO åœ¨ server ç«¯ä»¥åŠ iOS ç«¯çš„ä¸€äº›å¯¦ä½œåˆ†äº«ã€‚
Server é¦–å…ˆæˆ‘å€‘å¯ä»¥å…ˆå¾ Socket.IO çš„ Get started é–‹å§‹ï¼Œå®ƒæ˜¯ä»¥ Node.JS æ‰€ç·¨å¯«çš„ï¼Œæ‰€ä»¥å…ˆåœ¨è³‡æ–™å¤¾ä½ç½®åŸ·è¡Œ
npm init é‚Šå¯ä»¥å–å¾—åŸºæœ¬çš„ä¸€äº›æª”æ¡ˆå’Œ package.jsonã€‚ æ¥è‘—å®‰è£ Socket.IO æ‰€éœ€è¦çš„ express
npm install --save express@4.15.2 ç„¶å¾Œæ–°å»ºä¸€å€‹ index.js çš„æª”æ¡ˆï¼Œè²¼ä¸Š
var app = require(&amp;#39;express&amp;#39;)(); var http = require(&amp;#39;http&amp;#39;).Server(app); app.get(&amp;#39;/&amp;#39;, function(req, res){ res.send(&amp;#39;&amp;lt;h1&amp;gt;Hello world&amp;lt;/h1&amp;gt;&amp;#39;); }); http.listen(3000, function(){ console.log(&amp;#39;listening on *:3000&amp;#39;); }); é€™æ¨£å¾…æœƒåŸ·è¡Œ node index.js çš„æ™‚å€™ä¾¿å¯ä»¥å¾ http://localhost:3000 ä¾†é€£ä¸Šé€™å€‹ serverã€‚
ç¢ºèª server ç›®å‰æ˜¯å¯ä»¥é€£ä¸Šå¾Œï¼Œä¾¿é–‹å§‹å®‰è£ Socket.IO åˆ°å…¶ä¸­
npm install --save socket.io ä¸¦åœ¨ index.js è£é ­åŠ ä¸Š Socket.">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-149460095-2','auto'),ga('send','pageview'))</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4467778867013569" crossorigin=anonymous></script>
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
on-phone--column extended">
<aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info>
<figure class=site-avatar>
<img src=/img/Archie_hu1fc091553094f1283eaa3eeeb8ec0c46_37374_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>ğŸ’»</span>
</figure>
<h1 class=site-name><a href=https://www.archie.tw>Archie</a></h1>
<h2 class=site-description>ç¨ç«‹é–‹ç™¼è€…çš„å¿ƒè·¯æ­·ç¨‹</h2>
</header>
<ol class=menu id=main-menu>
<li>
<a href=/ target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>é¦–é </span>
</a>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span></span>
</li>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/backend/>
ğŸ’» Backend
</a>
</header>
<h2 class=article-title>
<a href=/p/socket.io/>Socket.IO</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 13, 2018</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>é€™ç¯‡æ–‡ç« æœƒä»‹ç´¹æœ‰é—œæ–¼ Socket.IO åœ¨ server ç«¯ä»¥åŠ iOS ç«¯çš„ä¸€äº›å¯¦ä½œåˆ†äº«ã€‚</p>
<h1 id=server>Server</h1>
<p>é¦–å…ˆæˆ‘å€‘å¯ä»¥å…ˆå¾ Socket.IO çš„ <a class=link href=https://socket.io/get-started/chat/ target=_blank rel=noopener>Get started</a> é–‹å§‹ï¼Œå®ƒæ˜¯ä»¥ Node.JS æ‰€ç·¨å¯«çš„ï¼Œæ‰€ä»¥å…ˆåœ¨è³‡æ–™å¤¾ä½ç½®åŸ·è¡Œ</p>
<pre tabindex=0><code>npm init
</code></pre><p>é‚Šå¯ä»¥å–å¾—åŸºæœ¬çš„ä¸€äº›æª”æ¡ˆå’Œ package.jsonã€‚
æ¥è‘—å®‰è£ Socket.IO æ‰€éœ€è¦çš„ express</p>
<pre tabindex=0><code>npm install --save express@4.15.2
</code></pre><p>ç„¶å¾Œæ–°å»ºä¸€å€‹ index.js çš„æª”æ¡ˆï¼Œè²¼ä¸Š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)();</span>
<span class=kd>var</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>).</span><span class=nx>Server</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
<span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>){</span>
    <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;&lt;h1&gt;Hello world&lt;/h1&gt;&#39;</span><span class=p>);</span>
<span class=p>});</span>
<span class=nx>http</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=kd>function</span><span class=p>(){</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;listening on *:3000&#39;</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div><p>é€™æ¨£å¾…æœƒåŸ·è¡Œ node index.js çš„æ™‚å€™ä¾¿å¯ä»¥å¾ http://localhost:3000 ä¾†é€£ä¸Šé€™å€‹ serverã€‚</p>
<p>ç¢ºèª server ç›®å‰æ˜¯å¯ä»¥é€£ä¸Šå¾Œï¼Œä¾¿é–‹å§‹å®‰è£ Socket.IO åˆ°å…¶ä¸­</p>
<pre tabindex=0><code>npm install --save socket.io
</code></pre><p>ä¸¦åœ¨ index.js è£é ­åŠ ä¸Š Socket.IO çš„ codeï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=kd>var</span> <span class=nx>io</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;socket.io&#39;</span><span class=p>)(</span><span class=nx>http</span><span class=p>);</span>
<span class=nx>io</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>socket</span><span class=p>){</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;a user connected&#39;</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div><p>é€™æ¨£ä¾¿å®Œæˆç›£è½ client é€£æ¥ä¸Š server çš„äº‹ä»¶äº†ã€‚</p>
<p><code>connection</code> æ˜¯ socket.io æ‰€å®šç¾©çš„ eventï¼Œè€Œé€™å€‹ event æœƒå–å¾— socket å›ä¾†ï¼Œæ‰€ä»¥ä»¥ function(socket) çš„æ–¹å¼å»æ¥æ”¶ä¸¦è™•ç†å¾ŒçºŒã€‚
ä¸éé€™è£¡çš„ io å¯ä»¥æƒ³æˆæ˜¯ä¸€å€‹ serverï¼Œæ‰€ä»¥æ¯æ”¶åˆ°ä¸€å€‹ client çš„ connection äº‹ä»¶ï¼Œéƒ½æœƒåŸ·è¡Œ function(socket)ï¼›è€Œæˆ‘å€‘è‹¥è¦ç›£è½å€‹åˆ¥é€£ç·šçš„äº‹ä»¶ï¼Œå‰‡æ˜¯ä½¿ç”¨ socket ä¾†è™•ç†ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;disconnect&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(){</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;user disconnected&#39;</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div><p>ä¹Ÿå°±æ˜¯èªªï¼Œåƒæ˜¯ç™»å…¥ã€å‚³é€è¨Šæ¯ç­‰ï¼Œå’Œå€‹åˆ¥ä½¿ç”¨è€…ç›¸é—œçš„å‹•ä½œï¼Œæˆ‘å€‘éƒ½æ˜¯ä»¥ socket ä¾†è™•ç†ã€‚</p>
<p>è€Œé™¤äº†ç›£è½ï¼ˆonï¼‰å¤–ï¼Œç™¼é€ï¼ˆemitï¼‰çš„å‹•ä½œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåƒæ˜¯æˆ‘æƒ³æ¨ä¸€æ®µæ–‡å­—çµ¦ç‰¹å®šçš„ä½¿ç”¨è€…ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>socket</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;new message&#39;</span><span class=p>,</span> <span class=s1>&#39;å—¨ï¼&#39;</span><span class=p>);</span>
</code></pre></div><p>åœ¨ client ä»¥åŠ server ç«¯å…ˆå½¼æ­¤å®šç¾©å¥½ event åç¨±ï¼Œé€™æ¨£å°±å¯ä»¥çŸ¥é“è¦ç›£è½çš„äº‹ä»¶ç‚ºå“ªäº›ã€‚</p>
<p>ä»€éº¼æ™‚å€™è©²ç”¨ io ç™¼é€ï¼Œä»€éº¼æ™‚å€™è©²ç”¨ socket å‘¢ï¼Ÿ</p>
<p>èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹ Socket.IO çš„å¤§èŠå¤©å®¤ï¼Œä»»ä½•äººåªè¦é€£ä¸Šé€™å€‹ç¶²å€ï¼Œä¾¿ç­‰åŒæ–¼åŠ å…¥é€™å€‹èŠå¤©å®¤ã€‚</p>
<ul>
<li>ä½¿ç”¨è€…ä¸Šã€ä¸‹ç·šæœƒé¡¯ç¤ºæé†’</li>
<li>èªªé«’è©±çš„äººæœƒå€‹åˆ¥æ”¶åˆ°ã€Œæ­¤è¨Šæ¯ç„¡æ³•å‚³é€ã€çš„è¨Šæ¯</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>io</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>socket</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>io</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;new user&#39;</span><span class=p>,</span> <span class=s1>&#39;æœ‰äººåŠ å…¥äº†é€™å€‹èŠå¤©å®¤ï¼&#39;</span><span class=p>);</span>
    <span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;add message&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>from</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>&#39;é¦¬çš„&#39;</span><span class=p>)</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
            <span class=nx>socket</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;new message&#39;</span><span class=p>,</span> <span class=s1>&#39;æ­¤è¨Šæ¯ç„¡æ³•å‚³é€&#39;</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=nx>io</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;new message&#39;</span><span class=p>,</span> <span class=nx>from</span> <span class=o>+</span> <span class=s1>&#39; èªªï¼š&#39;</span> <span class=o>+</span> <span class=nx>message</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>})</span>
    <span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;disconnect&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>io</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;user leave&#39;</span><span class=p>,</span> <span class=s1>&#39;æœ‰äººé›¢é–‹äº†é€™å€‹èŠå¤©å®¤ï¼&#39;</span><span class=p>);</span>
    <span class=p>});</span>
<span class=p>});</span>
</code></pre></div><p>ä¸Šé¢ä¾¿å¯ä»¥å¾—çŸ¥å“ªç¨®æ™‚å€™æ‡‰è©²è¦å¤§å®¶éƒ½å¯ä»¥æ¥æ”¶åˆ°ã€è€Œå“ªç¨®æ˜¯åªæœƒæœ‰å€‹åˆ¥çš„ä½¿ç”¨è€…æ¥æ”¶åˆ°ã€‚
å†ä¾†ä»‹ç´¹ä¸€ä¸‹ ackï¼Œåœ¨ç™¼é€ä¸€å€‹ event æ™‚ï¼Œå¯ä»¥åœ¨å¾Œé¢è£œä¸Šä¸€å€‹ ackï¼Œè€Œç•¶å°æ–¹æ”¶åˆ°çš„æ™‚å€™ï¼Œå¯ä»¥é€é ack ä¾†å‚³é dataï¼Œè€Œéå†ç™¼é€ä¸€å€‹æ–°çš„ eventã€‚
æœ‰é»åƒæ˜¯ HTTP request çš„æ¦‚å¿µï¼Œç™¼é€ä¸€å€‹ requestï¼ˆemitï¼‰ï¼Œæ¥è‘—å°æ–¹æœƒå›å‚³ responseï¼ˆackï¼‰ï¼Œä¸éé€™ä¸¦ä¸ä¸€å®šæœƒæœ‰ï¼Œä¹Ÿå°±æ˜¯èªªä½ ç™¼é€ï¼ˆemitï¼‰äº†ä¸€å€‹ event éå»ï¼Œé›–ç„¶æœ‰å¤¾å¸¶è‘— ackï¼Œä½†æ˜¯å°æ–¹è‹¥æ²’æ¥æ”¶é‚£å€‹ ack çš„è©±ä¹Ÿæ˜¯æ²’ç”¨ã€‚</p>
<p>é€™é‚Šæ˜¯ä¸€å€‹ä¾‹å­ï¼Œæˆ‘å€‘å¾ server çµ¦æ²’æœ‰æ”¶éé€™å‰‡å»£å‘Šçš„ä½¿ç”¨è€…å‚³é€ä¸€å‰‡éå»ï¼Œä¸¦å¸Œæœ›ä½¿ç”¨è€…çœŸçš„æœ‰æ”¶åˆ°ï¼Œè‹¥æ²’æ”¶åˆ°ä¸‹æ¬¡å°±å†å‚³ä¸€æ¬¡ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=c1>// åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦æœ‰æ”¶åˆ°éå»£å‘Šï¼Œè‹¥æ²’æœ‰çš„è©±åŸ·è¡Œ
</span><span class=c1></span><span class=nx>socket</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;new advertise&#39;</span><span class=p>,</span> <span class=s1>&#39;æ­å–œæ‚¨ç²å¾— $1,000 å…ƒæŠ˜æ‰£ï¼&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>userID</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;ä½¿ç”¨è€…(&#39;</span> <span class=o>+</span> <span class=nx>userID</span> <span class=o>+</span> <span class=s1>&#39;)æ”¶åˆ°å»£å‘Šäº†ï¼&#39;</span><span class=p>);</span>
    <span class=c1>//å»è³‡æ–™åº«æ›´æ–°ï¼Œä¸‹æ¬¡ä¸ç”¨å†æ¨çµ¦é€™å€‹ userID
</span><span class=c1></span><span class=p>)};</span>
</code></pre></div><p>å…¶ä¸­ï¼Œfunction(userID) ä¾¿æ˜¯ä¸€å€‹ ack æˆ–è€…å¯ä»¥èªªæ˜¯ callbackã€‚
ç›¸å°çš„ï¼Œæ”¶åˆ°è¨Šæ¯çš„æ™‚å€™ï¼Œserver ä¹Ÿå¯ä»¥å›å‚³ ack å›å»çµ¦ client å‘ŠçŸ¥ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;add message&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>text</span><span class=p>,</span> <span class=nx>ack</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;æ”¶åˆ°: &#39;</span> <span class=o>+</span> <span class=nx>text</span><span class=p>);</span>
    <span class=nx>ack</span><span class=p>(</span><span class=err>&#39;</span><span class=nx>ä¼ºæœå™¨æ”¶åˆ°ä½ çš„è¨Šæ¯äº†</span><span class=err>ï¼</span><span class=nx>è«‹æ”¾å¿ƒ</span><span class=err>ï¼</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div><p>å¦‚æ­¤ä¸€ä¾†ï¼Œä¾¿æœƒåœ¨æ”¶åˆ°è¨Šæ¯ä¹‹å¾Œï¼Œä»¥ ack çš„æ–¹å¼å›å‚³è¨Šæ¯å›å»ã€‚
è€Œ ack å’Œ emit æ‰€ç™¼é€å‡ºå»æœ‰ä»€éº¼ä¸åŒï¼Ÿ
åœ¨ Socket.IO çš„ protocol è£é ­æœ‰å®šç¾©ï¼š</p>
<ul>
<li>Packet#CONNECT ( 0 )</li>
<li>Packet#DISCONNECT ( 1 )</li>
<li>Packet#EVENT ( 2)</li>
<li>Packet#ACK ( 3 )</li>
<li>Packet#ERROR ( 4 )</li>
<li>Packet#BINARY_EVENT ( 5 )</li>
<li>Packet#BINARY_ACK ( 6 )
æ‰€ä»¥å…¶å¯¦é›–ç„¶å‹•ä½œé¡ä¼¼ï¼Œä½† Socket.IO å¯ä»¥è¾¨åˆ¥å…¶ä¸­çš„å·®ç•°ï¼Œé€²è€Œå¯ä»¥åœ¨ Socket ä¹‹ä¸­é”åˆ° Requestã€Response çš„æ¦‚å¿µã€‚</li>
</ul>
<h2 id=client>Client</h2>
<p>Client çš„éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨ Socket.IO æ‰€æä¾›çš„ Swift frameworkï¼Œå®ƒæ˜¯åŸºæ–¼ Starscream æ‰€é–‹ç™¼å‡ºä¾†çš„ï¼Œå¦‚åŒä¸Šè¿°èªªçš„æœ‰ä½¿ç”¨åˆ° WebSocket ä¾†é€£æ¥ã€‚
ä»¥ Swift ä¾†èªªï¼š</p>
<p>let manager = SocketManager(socketURL: URL(string: &ldquo;http://localhost:3000&rdquo;)!, config: [configs])
let socket = manager.defaultSocket
é€™é‚Šä»‹ç´¹å¹¾å€‹æˆ‘æ‰€ä½¿ç”¨åˆ°çš„ configs</p>
<ul>
<li>.log(true)ï¼šé–‹å•Ÿ LOG çš„åŠŸèƒ½ã€‚</li>
<li>.forceWebsockets(true)ï¼šè‹¥æ²’æœ‰ä½¿ç”¨é€™å€‹çš„è©±ï¼Œæœƒä»¥ HTTP polling çš„æ–¹å¼é€£æ¥ï¼Œå¾ header ä¾†çœ‹çš„è©±ï¼Œå°±æœƒé¡¯ç¤º connection: keep-aliveï¼›è€Œä½¿ç”¨äº† .forceWebsockets(true) çš„è©±ï¼Œå‰‡æœƒä½¿ç”¨ WebSocket ä¾†é€£ç·šï¼Œå‰‡æœƒé¡¯ç¤º connection: upgradeã€‚</li>
<li>.reconnectAttempts(int)ï¼šé‡æ–°å˜—è©¦é€£ç·š n æ¬¡ï¼Œè¶…éå°±æ”¾æ£„ã€‚</li>
<li>.connectParams([String: Any])ï¼šé€™é‚Šå¯ä»¥æ”¾ token ä¾†åš Authenticationã€‚</li>
</ul>
<p>ç‚ºä»€éº¼ä¸åœ¨ header è£é ­åŠ ä¸Š Authentication çš„æ¬„ä½ï¼Ÿ</p>
<p><a class=link href=https://socket.io/docs/client-api/#With-extraHeaders target=_blank rel=noopener>é€™é‚Š Socket.IO æœ‰åšè§£é‡‹ï¼Œç‚ºä»€éº¼ä¸å»ºè­°åœ¨ extraHeaders åŠ æ±è¥¿ã€‚</a></p>
<p>è€Œ on / emit / emitWithAck é€™å¹¾å€‹çš„ç”¨æ³•å°±å’Œ server çš„æ¦‚å¿µä¸€æ¨£ï¼Œé€™é‚Šå°±ä¸å†å¤šåšè§£é‡‹ï¼Œ</p>
<p>ä¹‹å¾Œå¯¦ä½œæœ‰é‡åˆ°ä»€éº¼äº‹æƒ…å†ä¾†è£œå……ï¼ˆæˆ–æ˜¯æ–°æ–‡ç« ï¼‰ï¼</p>
</section>
<footer class=article-footer>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title></h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/go-%E7%9A%84%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8%E4%BD%BF%E7%94%A8/>
<div class=article-details>
<h2 class=article-title>Go çš„ç’°å¢ƒè®Šæ•¸ä½¿ç”¨</h2>
</div>
</a>
</article>
<article>
<a href=/p/%E9%BA%A5%E7%95%B6%E5%8B%9E%E5%A0%B1%E5%A0%B1-api-%E5%88%86%E6%9E%90/>
<div class=article-details>
<h2 class=article-title>éº¥ç•¶å‹å ±å ± API åˆ†æ</h2>
</div>
</a>
</article>
<article>
<a href=/p/%E4%BD%BF%E7%94%A8-api-%E4%BE%86%E8%AE%80%E5%8F%96-github-repository/>
<div class=article-details>
<h2 class=article-title>ä½¿ç”¨ API ä¾†è®€å– GitHub repository</h2>
</div>
</a>
</article>
<article>
<a href=/p/aws-certificate-manager-%E7%94%B3%E8%AB%8B%E6%B5%81%E7%A8%8B/>
<div class=article-details>
<h2 class=article-title>AWS Certificate Manager ç”³è«‹æµç¨‹</h2>
</div>
</a>
</article>
<article>
<a href=/p/aws-ec2-with-wordpress/>
<div class=article-details>
<h2 class=article-title>AWS EC2 with WordPress</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//archie-1.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2017 -
2021 Archie
</section>
<section class=powerby>
<br>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>