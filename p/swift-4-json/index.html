<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在 Swift 之中，JSON (JavaScript Object Notation) 的型別為 [String: Any]， 也就是一個 Dictionary 的概念，以一組 Key 對應一組 Value。 大多數會碰到 JSON 格式是在做網路溝通時， 使用 JSON 格式並 encode 成 Data 的型態在傳輸資料。
Swift 3 以前 我們從 URLSession.shared.dataTask 的 handler 之中， 會得到 data、response 及 error，其中的 data 會使用下面的方式才轉換成 JSON：
/* Create a Foundation object from JSON data. Set the NSJSONReadingAllowFragments option if the parser should allow top-level objects that are not an NSArray or NSDictionary. Setting the NSJSONReadingMutableContainers option will make the parser generate mutable NSArrays and NSDictionaries."><title>Swift 4 JSON</title>
<link rel=canonical href=https://www.archie.tw/p/swift-4-json/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Swift 4 JSON">
<meta property="og:description" content="在 Swift 之中，JSON (JavaScript Object Notation) 的型別為 [String: Any]， 也就是一個 Dictionary 的概念，以一組 Key 對應一組 Value。 大多數會碰到 JSON 格式是在做網路溝通時， 使用 JSON 格式並 encode 成 Data 的型態在傳輸資料。
Swift 3 以前 我們從 URLSession.shared.dataTask 的 handler 之中， 會得到 data、response 及 error，其中的 data 會使用下面的方式才轉換成 JSON：
/* Create a Foundation object from JSON data. Set the NSJSONReadingAllowFragments option if the parser should allow top-level objects that are not an NSArray or NSDictionary. Setting the NSJSONReadingMutableContainers option will make the parser generate mutable NSArrays and NSDictionaries.">
<meta property="og:url" content="https://www.archie.tw/p/swift-4-json/">
<meta property="og:site_name" content="Archie">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="iOS"><meta property="article:tag" content="Swift"><meta property="article:published_time" content="2017-09-20T00:00:00+00:00"><meta property="article:modified_time" content="2017-09-20T00:00:00+00:00">
<meta name=twitter:site content="@ChangArchie">
<meta name=twitter:creator content="@ChangArchie"><meta name=twitter:title content="Swift 4 JSON">
<meta name=twitter:description content="在 Swift 之中，JSON (JavaScript Object Notation) 的型別為 [String: Any]， 也就是一個 Dictionary 的概念，以一組 Key 對應一組 Value。 大多數會碰到 JSON 格式是在做網路溝通時， 使用 JSON 格式並 encode 成 Data 的型態在傳輸資料。
Swift 3 以前 我們從 URLSession.shared.dataTask 的 handler 之中， 會得到 data、response 及 error，其中的 data 會使用下面的方式才轉換成 JSON：
/* Create a Foundation object from JSON data. Set the NSJSONReadingAllowFragments option if the parser should allow top-level objects that are not an NSArray or NSDictionary. Setting the NSJSONReadingMutableContainers option will make the parser generate mutable NSArrays and NSDictionaries.">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-149460095-2','auto'),ga('send','pageview'))</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4467778867013569" crossorigin=anonymous></script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=https://www.archie.tw class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span></span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/%E9%96%8B%E7%99%BC%E5%BF%83%E5%BE%97/>
🍎 開發心得
</a>
</header>
<h2 class=article-title>
<a href=/p/swift-4-json/>Swift 4 JSON</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 20, 2017</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>在 Swift 之中，JSON (JavaScript Object Notation) 的型別為 [String: Any]，
也就是一個 Dictionary 的概念，以一組 Key 對應一組 Value。
大多數會碰到 JSON 格式是在做網路溝通時，
使用 JSON 格式並 encode 成 Data 的型態在傳輸資料。</p>
<h3 id=swift-3-以前>Swift 3 以前</h3>
<p>我們從 URLSession.shared.dataTask 的 handler 之中，
會得到 data、response 及 error，其中的 data 會使用下面的方式才轉換成 JSON：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=cm>/* Create a Foundation object from JSON data. Set the NSJSONReadingAllowFragments option if the parser should allow top-level objects that are not an NSArray or NSDictionary. Setting the NSJSONReadingMutableContainers option will make the parser generate mutable NSArrays and NSDictionaries. Setting the NSJSONReadingMutableLeaves option will make the parser generate mutable NSString objects. If an error occurs during the parse, then the error parameter will be set and the result will be nil.
</span><span class=cm>       The data must be in one of the 5 supported encodings listed in the JSON specification: UTF-8, UTF-16LE, UTF-16BE, UTF-32LE, UTF-32BE. The data may or may not have a BOM. The most efficient encoding to use for parsing is UTF-8, so if you have a choice in encoding the data passed to this method, use UTF-8.
</span><span class=cm>     */</span>
<span class=n>open</span> <span class=kd>class</span> <span class=nc>func</span> <span class=n>jsonObject</span><span class=p>(</span><span class=n>with</span> <span class=n>data</span><span class=p>:</span> <span class=n>Data</span><span class=p>,</span> <span class=n>options</span> <span class=n>opt</span><span class=p>:</span> <span class=n>JSONSerialization</span><span class=p>.</span><span class=n>ReadingOptions</span> <span class=p>=</span> <span class=p>[])</span> <span class=kr>throws</span> <span class=p>-&gt;</span> <span class=nb>Any</span>
</code></pre></div><p>接著我們再來對 JSON 的 Key 和 Value 來進行拆解：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=cm>/*
</span><span class=cm>{
</span><span class=cm>    &#34;status&#34;: true,
</span><span class=cm>    &#34;user&#34;: {
</span><span class=cm>        &#34;ID&#34;: &#34;1234567890&#34;,
</span><span class=cm>        &#34;name&#34;: &#34;Archie&#34;,
</span><span class=cm>        &#34;email&#34;: &#34;example@example.com&#34;
</span><span class=cm>}
</span><span class=cm>*/</span>

<span class=k>guard</span> <span class=kd>let</span> <span class=nv>status</span> <span class=p>=</span> <span class=n>result</span><span class=p>[</span><span class=s>&#34;status&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=nb>Bool</span><span class=p>,</span>
    <span class=kd>let</span> <span class=nv>ID</span> <span class=p>=</span> <span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s>&#34;user&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=p>[</span><span class=nb>String</span><span class=p>:</span> <span class=nb>Any</span><span class=p>])?[</span><span class=s>&#34;ID&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=nb>String</span><span class=p>,</span>
    <span class=kd>let</span> <span class=nv>name</span> <span class=p>=</span> <span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s>&#34;user&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=p>[</span><span class=nb>String</span><span class=p>:</span> <span class=nb>Any</span><span class=p>])?[</span><span class=s>&#34;name&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=nb>String</span><span class=p>,</span>
    <span class=kd>let</span> <span class=nv>email</span> <span class=p>=</span> <span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s>&#34;user&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=p>[</span><span class=nb>String</span><span class=p>:</span> <span class=nb>Any</span><span class=p>])?[</span><span class=s>&#34;email&#34;</span><span class=p>]</span> <span class=k>as</span><span class=p>?</span> <span class=nb>String</span> <span class=k>else</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=n>Error</span>
<span class=p>}</span>
</code></pre></div><p>而巢狀式的 JSON 格式，寫起來的 code 就會越長，進而衍生出 SwiftyJSON，有興趣的可以自行看一下。</p>
<h3 id=swift-4>Swift 4</h3>
<p>那 Swift 4 做了哪種改變呢？
在 Foundation 裡頭，增加了 Encoder/Decoder 相關的內容，
而這邊先以 JSON 作為主要的內容。
以 User 作為例子：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=cm>/*
</span><span class=cm>{
</span><span class=cm>    &#34;name&#34;: &#34;Archie&#34;,
</span><span class=cm>    &#34;email&#34;: &#34;example@example.com&#34;,
</span><span class=cm>    &#34;status: &#34;Active&#34;,
</span><span class=cm>    &#34;updated_time&#34;: &#34;2017-09-20T00:00:00Z&#34;
</span><span class=cm>}
</span><span class=cm>*/</span>

<span class=kd>enum</span> <span class=nc>UserStatus</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>Codable</span> <span class=p>{</span>
    <span class=k>case</span> <span class=n>active</span> <span class=p>=</span> <span class=s>&#34;Active&#34;</span>
    <span class=k>case</span> <span class=n>disable</span> <span class=p>=</span> <span class=s>&#34;Disable:&#34;</span>
<span class=p>}</span>

<span class=kd>struct</span> <span class=nc>User</span><span class=p>:</span> <span class=n>Codable</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nv>name</span><span class=p>:</span> <span class=nb>String</span>
    <span class=kd>var</span> <span class=nv>email</span><span class=p>:</span> <span class=nb>String</span>
    <span class=kd>var</span> <span class=nv>status</span><span class=p>:</span> <span class=n>UserStatus</span>
    <span class=kd>var</span> <span class=nv>updatedTime</span><span class=p>:</span> <span class=n>Date</span>
    
    <span class=c1>// if keys need to replace by others</span>
    <span class=kd>enum</span> <span class=nc>CodingKeys</span> <span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>CodingKey</span> <span class=p>{</span>
          <span class=k>case</span> <span class=n>name</span>
          <span class=k>case</span> <span class=n>email</span> 
          <span class=k>case</span> <span class=n>status</span> 
          <span class=k>case</span> <span class=n>updatedTime</span> <span class=p>=</span> <span class=s>&#34;updated_time&#34;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// encoder</span>
<span class=kd>let</span> <span class=nv>encoder</span> <span class=p>=</span> <span class=n>JSONEncoder</span><span class=p>()</span>

<span class=c1>// set date encoding strategy to iso8601</span>
<span class=c1>// default is TimeInterval</span>
<span class=n>encoder</span><span class=p>.</span><span class=n>dateEncodingStrategy</span> <span class=p>=</span> <span class=p>.</span><span class=n>iso8601</span>

<span class=c1>// user convert to data</span>
<span class=kd>let</span> <span class=nv>data</span> <span class=p>=</span> <span class=k>try</span><span class=p>!</span> <span class=n>encoder</span><span class=p>.</span><span class=n>encode</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>

<span class=c1>// decoder</span>
<span class=kd>let</span> <span class=nv>decoder</span> <span class=p>=</span> <span class=n>JSONDecoder</span><span class=p>()</span>

<span class=c1>// data convert to user</span>
<span class=kd>let</span> <span class=nv>user</span> <span class=p>=</span> <span class=k>try</span><span class=p>!</span> <span class=n>decoder</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=kc>self</span><span class=p>,</span> <span class=n>from</span><span class=p>:</span> <span class=n>data</span><span class=p>)</span>
</code></pre></div><p>其中，Codable 是指 Encodable 和 Decodable，
若你只需要做 data parse 的話，也可以僅宣告 Decodable。</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/ios/>iOS</a>
<a href=/tags/swift/>Swift</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title></h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/%E7%99%BC%E7%A5%A8%E6%94%B6%E9%9B%86%E9%9B%9E-%E8%87%AA%E5%B7%B1%E7%9A%84%E7%99%BC%E7%A5%A8%E8%87%AA%E5%B7%B1%E6%94%B6/>
<div class=article-details>
<h2 class=article-title>發票收集雞 - 自己的發票自己收</h2>
</div>
</a>
</article>
<article>
<a href=/p/apple-watch-app-%E9%96%8B%E7%99%BC%E9%99%A4%E9%8C%AF%E5%BF%83%E5%BE%97/>
<div class=article-details>
<h2 class=article-title>Apple Watch App 開發除錯心得</h2>
</div>
</a>
</article>
<article>
<a href=/p/rxswift-6-%E4%B8%8A%E7%B7%9A%E5%95%A6/>
<div class=article-details>
<h2 class=article-title>RxSwift 6 上線啦！</h2>
</div>
</a>
</article>
<article>
<a href=/p/ios-%E9%80%86%E5%90%91%E4%B8%8B%E8%BC%89-instagram-%E5%8B%95%E6%85%8B%E7%85%A7%E7%89%87/>
<div class=article-details>
<h2 class=article-title>【iOS 逆向】下載 Instagram 動態照片</h2>
</div>
</a>
</article>
<article>
<a href=/p/ios-app-launch-time-%E5%BF%83%E5%BE%97/>
<div class=article-details>
<h2 class=article-title>iOS App launch time 心得</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//archie-1.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2017 -
2021 Archie
</section>
<section class=powerby>
<br>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title"></h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li>
<ol>
<li><a href=#swift-3-以前>Swift 3 以前</a></li>
<li><a href=#swift-4>Swift 4</a></li>
</ol>
</li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>